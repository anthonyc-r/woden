"
I am an asset model that is usually generated by an external 3D design application. Unlike a simple model, I represent a template for a subset of a scene graph.
"
Class {
	#name : #WDSSceneAssetModel,
	#superclass : #WDCAbstractModel,
	#instVars : [
		'mainScene',
		'scenes'
	],
	#category : #'WodenEngine-Scene-Asset'
}

{ #category : #'as yet unclassified' }
WDSSceneAssetModel >> createViewer [
	| sceneModel camera hasLights sunLight skyTexture viewScene |
	sceneModel := WDASampleSceneModel new.
	viewScene := mainScene copy.
	sceneModel
		scene: viewScene.
	viewScene backgroundColor: Color darkGray.
	viewScene initializeWithEngine: sceneModel engine.
	
	"Try to find a camera."
	hasLights := false.
	viewScene allChildrenDo: [ :node |
		hasLights := hasLights or: [node isLightSource].
		node isCamera ifTrue: [
			node isNotControlledByTheUser: true.
			sceneModel camera: node
		]
	].

	"If not camera is found, then we have to create a camera for the scene."
	sceneModel camera ifNil: [ 
		camera := WDSGCamera new.
		
		viewScene add: camera.
		sceneModel camera: camera.
	].

	hasLights ifFalse: [
		"Add a light"
		sunLight := WDSGLightSource new.
		sunLight
			directional; castShadows: false;
			intensity: (WMVector4F x: 1.0 y: 1.0 z: 0.8) normalized * 0.6;
			rotateDegreesOnX: -35.
		
		viewScene add: sunLight.

		viewScene ambientLighting: WMVector4F ones*0.6.
		
		skyTexture := WDASceneExamples proceduralSkySunDirection: (sunLight transform
				transformVector3:(WMVector3F z: 1.0)
			).
		skyTexture := skyTexture asSRGBTextureFor: sceneModel engine.
		viewScene createSkyWithCubeTexture: skyTexture.
	].

	^ sceneModel
]

{ #category : #accessing }
WDSSceneAssetModel >> mainScene [
	^ mainScene
]

{ #category : #accessing }
WDSSceneAssetModel >> mainScene: anObject [
	mainScene := anObject
]

{ #category : #'as yet unclassified' }
WDSSceneAssetModel >> openViewer [
	^ self createViewer openWith: WDAFPSSceneView allowingVR.
]

{ #category : #accessing }
WDSSceneAssetModel >> scenes [
	^ scenes
]

{ #category : #accessing }
WDSSceneAssetModel >> scenes: anObject [
	scenes := anObject
]
